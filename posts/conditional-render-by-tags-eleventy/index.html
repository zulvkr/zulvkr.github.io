<!doctype html><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="stylesheet" href="/main.css"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/icon.svg" type="image/svg+xml"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="manifest" href="/manifest.webmanifest"><title>Conditional Render by Tags in Eleventy</title></head><body><header class="border-b lg:border-r lg:fixed lg:w-2/6 lg:h-full lg:pt-8 bg-gray-50 lg:border-b-0"><div class="mx-auto max-w-prose"><nav class="p-4 text-sm lg:px-6"><ul class="flex flex-wrap"><li class="flex-shrink-0"><a class="block px-3 pt-6" href="/">/zul/</a></li><li class="flex-shrink-0"><a class="block px-3 pt-6" href="/about/">About</a></li><li class="flex-shrink-0"><a class="block px-3 pt-6" href="https://docs.google.com/document/d/e/2PACX-1vSzAlfJdrYeyyCS3P4KfxTO3p2s3hUH_WazrzVm518IG12g0Ul1sZf_nYymJC-SqqNXTgWrh-Kw5RvD/pub">Hire me</a></li><li class="flex-shrink-0 ml-auto"><a class="block pt-4 w-7" href="https://github.com/zulvkr"><svg width="100%" height="100%" version="1.1" viewBox="0 0 11.493 11.209" xmlns="http://www.w3.org/2000/svg"><g transform="translate(-82.861 -76.986)"><path d="m88.607 76.986c-3.1732 0-5.746 2.5728-5.746 5.7467 0 2.5389 1.6464 4.6926 3.9299 5.4529 0.28751 0.0526 0.39229-0.12488 0.39229-0.27728 0-0.13617-0.0049-0.49777-0.0078-0.9772-1.5984 0.34714-1.9357-0.77046-1.9357-0.77046-0.26141-0.66358-0.63818-0.84032-0.63818-0.84032-0.52176-0.35666 0.03951-0.3496 0.03951-0.3496 0.57679 0.0409 0.88018 0.59231 0.88018 0.59231 0.51259 0.87807 1.3451 0.62442 1.6725 0.47766 0.05221-0.37147 0.20038-0.62477 0.36477-0.76835-1.276-0.14499-2.6176-0.63817-2.6176-2.8402 0-0.62724 0.22401-1.1402 0.59161-1.542-0.05927-0.14535-0.25647-0.72955 0.05609-1.5208 0 0 0.4826-0.15451 1.5804 0.58914 0.45826-0.12735 0.95003-0.1912 1.4386-0.19332 0.48789 2e-3 0.97966 0.066 1.4386 0.19332 1.0971-0.74365 1.5787-0.58914 1.5787-0.58914 0.31362 0.79128 0.11642 1.3755 0.05715 1.5208 0.3683 0.40181 0.5909 0.91475 0.5909 1.542 0 2.2077-1.3437 2.6935-2.624 2.8356 0.20638 0.17744 0.39017 0.52811 0.39017 1.0643 0 0.768-0.0071 1.3878-0.0071 1.5762 0 0.15381 0.10336 0.33267 0.39511 0.27658 2.2818-0.76165 3.9268-2.914 3.9268-5.4522 0-3.1739-2.5732-5.7467-5.7471-5.7467" fill="currentColor" fill-rule="evenodd"/></g></svg></a></li></ul></nav><div class="px-4 py-8 lg:px-6"><p class="pb-4 text-sm">â€” June 17th, 2021</p><h1 id="title" class="pb-6 text-5xl font-bold text-gray-900">Conditional Render by Tags in Eleventy</h1><h2 id="description" class="text-lg max-w-xs italic text-gray-600">How to render item conditionally based on tags in Eleventy using Nunjucks</h2></div></div></header><div class="lg:grid lg:grid-cols-6"><div class="lg:col-start-3 lg:col-span-3"><div class="px-4 pt-5 pb-8 mx-auto lg:pt-12 max-w-prose lg:px-6"><div><article class="prose"><div class="font-serif"><p>Nunjucks are funny templating language. It seems to have a lot of unusual behavior that doesn't match with JavaScript syntax. Maybe because it's inspired by Jinja 2 that makes it has some Python characteristics.</p><p>Recently I was trying to find a clean way to render items conditionally based on availabililty of tags and met a stumble block. At first, I tried to make custom filter like this:</p><pre><code class="language-nunjucks">eleventyConfig.addFilter('includesPost', arr =&gt; arr.includes('post'))
</code></pre><p>The custom filter supposed to check if <code>tags</code> of a post includes <code>post</code> tag as its member. Tags are array in Eleventy so I expected a smooth journey, but things go awry in the console. Eleventy crashed when rendering root <code>/index.html</code> file.</p><p>After careful inspection on the rendering error, I realized that the filter were always trying to iterate over uniterable item before crashing.</p><p>This makes me utterly confused, how could that be possible? Is it possible that tags didn't always return array but stringified value?</p><p>One trick I managed to learn is to print the value of objects using built-in Nunjucks <code>dump()</code> filter. It turned out that <code>tags</code> is array as expected.</p><pre><code class="language-nunjucks">{{ tags | dump(2) }}

{# it prints ['tag1', 'post'] just fine #}
</code></pre><p>Some testing and an hour of debugging later, the culprit was found! Not every post in Eleventy has <code>tags</code> as property, which makes caling <code>tags</code> key will return <code>undefined</code> when reaching some pages. Wild <code>undefined</code> tags consistently appeared in any posts that has no tags assigned in their frontmatter.</p><p>So, I need to prevent <code>tags</code> being iterated when <code>tags</code> is <code>undefined</code>:</p><pre><code class="language-nunjucks">{% if not tags %}
{% elif (tags | includesPost) %}
  render something
{% endif %}
</code></pre><p>Well, some Googling later I found a gem! See the second line.</p><pre><code class="language-nunjucks">{% if not tags %}
{% elif 'post' in tags %}
  render something
{% endif %}
</code></pre><p>The code above is my latest solution. The <code>in</code> syntax works similarly as <code>arr.includes()</code> in JavaScript. This syntax is borrowed from Python and not available in the Nunjucks documentation. So you have to have some familiarity with Python and Jinja to know it. Ugh, what a painful way to learn!</p><p>The <code>.includes()</code> method surprisingly also works inline in Nunjucks.</p><pre><code class="language-nunjucks">{% if not tags %}
{% elif tags.includes('post') %}
  render something
{% endif %}
</code></pre><p>Does all array methods work in Nunjucks? I don't even find this notion in the documentation, or is it obscured somewhere? I hope the ability to use built-in JavaScript object methods is written in prominent way in Nunjucks documentation. It's a game changer.</p><p>Anyway, both solutions are amazing for my use case! I ditched my custom filter and used these semantic syntax for this blog. Lots of thanks to Ryuno-ki who pointed <a href="https://github.com/11ty/eleventy/issues/524">this out in this thread</a> and all folks who contributed to that thread.</p></div></article></div></div></div><div class="lg:col-start-6 lg:col-span-1"></div></div></body>