<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Conditional Render by Tags in Eleventy</title><meta property="og:title" content="Conditional Render by Tags in Eleventy"><meta name="description" content="How to render item conditionally based on tags in Eleventy using Nunjucks"><meta property="og:description" content="How to render item conditionally based on tags in Eleventy using Nunjucks"><meta property="og:locale" content="en_US"><meta property="og:type" content="website"><meta property="og:url" content="/posts/conditional-render-by-tags-eleventy/"><link rel="canonical" href="/posts/conditional-render-by-tags-eleventy/"><link rel="stylesheet" href="/main.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prism-themes@1.7.0/themes/prism-atom-dark.css" media="print" onload="this.media=&quot;all&quot;"><link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" rel="stylesheet"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400;1,700&amp;family=Ubuntu+Condensed&amp;display=swap" rel="stylesheet" media="print" onload="this.media=&quot;all&quot;"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/icon.svg" type="image/svg+xml"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="manifest" href="/manifest.webmanifest"></head><body><header class="border-b xl:border-r xl:fixed xl:w-2/6 xl:h-full xl:pt-8 xl:border-b-0 bg-gray-50"><div class="mx-auto xl:ml-auto xl:mr-0 max-w-prose"><nav class="p-4 text-sm xl:px-6"><ul class="flex flex-wrap group"><li class="flex-shrink-0"><a class="block px-3 pt-6 pb-2 transition bg-slate-800 text-white" href="/">zulvkr</a></li><li class="flex-shrink-0"><a class="block px-3 pt-6 pb-2 transition hover:bg-black hover:bg-opacity-10" href="https://github.com/zulvkr">GitHub</a></li><li class="flex-shrink-0 ml-auto"><a class="block pt-4 w-7" href="/portfolio/"><svg width="100%" height="100%" version="1.1" viewBox="0 0 11.493 11.209" xmlns="http://www.w3.org/2000/svg"><g transform="translate(-82.861 -76.986)"><path d="m88.607 76.986c-3.1732 0-5.746 2.5728-5.746 5.7467 0 2.5389 1.6464 4.6926 3.9299 5.4529 0.28751 0.0526 0.39229-0.12488 0.39229-0.27728 0-0.13617-0.0049-0.49777-0.0078-0.9772-1.5984 0.34714-1.9357-0.77046-1.9357-0.77046-0.26141-0.66358-0.63818-0.84032-0.63818-0.84032-0.52176-0.35666 0.03951-0.3496 0.03951-0.3496 0.57679 0.0409 0.88018 0.59231 0.88018 0.59231 0.51259 0.87807 1.3451 0.62442 1.6725 0.47766 0.05221-0.37147 0.20038-0.62477 0.36477-0.76835-1.276-0.14499-2.6176-0.63817-2.6176-2.8402 0-0.62724 0.22401-1.1402 0.59161-1.542-0.05927-0.14535-0.25647-0.72955 0.05609-1.5208 0 0 0.4826-0.15451 1.5804 0.58914 0.45826-0.12735 0.95003-0.1912 1.4386-0.19332 0.48789 2e-3 0.97966 0.066 1.4386 0.19332 1.0971-0.74365 1.5787-0.58914 1.5787-0.58914 0.31362 0.79128 0.11642 1.3755 0.05715 1.5208 0.3683 0.40181 0.5909 0.91475 0.5909 1.542 0 2.2077-1.3437 2.6935-2.624 2.8356 0.20638 0.17744 0.39017 0.52811 0.39017 1.0643 0 0.768-0.0071 1.3878-0.0071 1.5762 0 0.15381 0.10336 0.33267 0.39511 0.27658 2.2818-0.76165 3.9268-2.914 3.9268-5.4522 0-3.1739-2.5732-5.7467-5.7471-5.7467" fill="currentColor" fill-rule="evenodd"/></g></svg></a></li></ul></nav><div class="px-4 py-8 xl:px-6"><p class="pb-4 text-sm">â€” June 17th, 2021</p><h1 id="title" class="pb-6 text-5xl font-display text-gray-900">Conditional Render by Tags in Eleventy</h1><p id="description" class="max-w-prose font-serif italic text-gray-600">How to render item conditionally based on tags in Eleventy using Nunjucks</p></div></div></header><div class="xl:grid xl:grid-cols-6"><div class="xl:col-start-3 xl:col-span-3"><div class="px-4 pt-5 pb-8 mx-auto xl:ml-6 xl:mr-auto xl:pt-12 max-w-prose xl:px-6"><div><article class="prose"><p>Nunjucks are funny templating language. It seems to have a lot of unusual behavior that doesn't match with JavaScript syntax. Maybe because it's inspired by Jinja 2 that makes it has some Python characteristics.</p><p>Recently I was trying to find a clean way to render items conditionally based on availabililty of tags and met a stumble block. At first, I tried to make custom filter like this:</p><pre class="language-js"><code class="language-js">eleventyConfig<span class="token punctuation">.</span><span class="token function">addFilter</span><span class="token punctuation">(</span><span class="token string">'includesPost'</span><span class="token punctuation">,</span> <span class="token parameter">arr</span> <span class="token operator">=></span> arr<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'post'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>The custom filter supposed to check if <code>tags</code> of a post includes <code>post</code> tag as its member. Tags are array in Eleventy so I expected a smooth journey, but things go awry in the console. Eleventy crashed when rendering root <code>/index.html</code> file.</p><p>After careful inspection on the rendering error, I realized that the filter were always trying to iterate over uniterable item before crashing.</p><p>This makes me utterly confused, how could that be possible? Is it possible that tags didn't always return array but stringified value?</p><p>One trick I managed to learn is to print the value of objects using built-in Nunjucks <code>dump()</code> filter. It turned out that <code>tags</code> is array as expected.</p><pre class="language-jinja2"><code class="language-jinja2"><span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{{</span> <span class="token variable">tags</span> <span class="token operator">|</span> <span class="token function">dump</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token delimiter punctuation">}}</span></span><br><br><span class="token jinja2 language-jinja2"><span class="token comment">{# it prints ['tag1', 'post'] just fine #}</span></span></code></pre><p>Some testing and an hour of debugging later, the culprit was found! Not every post in Eleventy has <code>tags</code> as property, which makes caling <code>tags</code> key will return <code>undefined</code> when reaching some pages. Wild <code>undefined</code> tags consistently appeared in any posts that has no tags assigned in their frontmatter.</p><p>So, I need to prevent <code>tags</code> being iterated when <code>tags</code> is <code>undefined</code>:</p><pre class="language-jinja2"><code class="language-jinja2"><span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">if</span> <span class="token keyword">not</span> <span class="token variable">tags</span> <span class="token delimiter punctuation">%}</span></span><br><span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">elif</span> <span class="token punctuation">(</span><span class="token variable">tags</span> <span class="token operator">|</span> <span class="token variable">includesPost</span><span class="token punctuation">)</span> <span class="token delimiter punctuation">%}</span></span><br>  render something<br><span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">endif</span> <span class="token delimiter punctuation">%}</span></span></code></pre><p>Well, some Googling later I found a gem! See the second line.</p><pre class="language-jinja2"><code class="language-jinja2"><span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">if</span> <span class="token keyword">not</span> <span class="token variable">tags</span> <span class="token delimiter punctuation">%}</span></span><br><span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">elif</span> <span class="token string">'post'</span> <span class="token keyword">in</span> <span class="token variable">tags</span> <span class="token delimiter punctuation">%}</span></span><br>  render something<br><span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">endif</span> <span class="token delimiter punctuation">%}</span></span></code></pre><p>The code above is my latest solution. The <code>in</code> syntax works similarly as <code>arr.includes()</code> in JavaScript. This syntax is borrowed from Python and not available in the Nunjucks documentation. So you have to have some familiarity with Python and Jinja to know it. Ugh, what a painful way to learn!</p><p>The <code>.includes()</code> method surprisingly also works inline in Nunjucks.</p><pre class="language-jinja2"><code class="language-jinja2"><span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">if</span> <span class="token keyword">not</span> <span class="token variable">tags</span> <span class="token delimiter punctuation">%}</span></span><br><span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">elif</span> <span class="token variable">tags</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'post'</span><span class="token punctuation">)</span> <span class="token delimiter punctuation">%}</span></span><br>  render something<br><span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">endif</span> <span class="token delimiter punctuation">%}</span></span></code></pre><p>Does all array methods work in Nunjucks? I don't even find this notion in the documentation, or is it obscured somewhere? I hope the ability to use built-in JavaScript object methods is written in prominent way in Nunjucks documentation. It's a game changer.</p><p>Anyway, both solutions are amazing for my use case! I ditched my custom filter and used these semantic syntax for this blog. Lots of thanks to Ryuno-ki who pointed <a href="https://github.com/11ty/eleventy/issues/524">this out in this thread</a> and all folks who contributed to that thread.</p></article></div></div></div></div></body></html>