<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Python Version and Dependency Management</title><meta property="og:title" content="Python Version and Dependency Management"><meta name="description" content="Learning Python as JavaScript Developer Series Part 1."><meta property="og:description" content="Learning Python as JavaScript Developer Series Part 1."><meta property="og:locale" content="en_US"><meta property="og:type" content="website"><meta property="og:url" content="/posts/python-series-1/"><link rel="canonical" href="/posts/python-series-1/"><link rel="stylesheet" href="/main.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prism-themes@1.7.0/themes/prism-atom-dark.css" media="print" onload="this.media=&quot;all&quot;"><link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" rel="stylesheet"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400;1,700&amp;family=Ubuntu+Condensed&amp;display=swap" rel="stylesheet" media="print" onload="this.media=&quot;all&quot;"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/icon.svg" type="image/svg+xml"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="manifest" href="/manifest.webmanifest"></head><body><header class="border-b xl:border-r xl:fixed xl:w-2/6 xl:h-full xl:pt-8 xl:border-b-0 bg-gray-50"><div class="mx-auto xl:ml-auto xl:mr-0 max-w-prose"><nav class="p-4 text-sm xl:px-6"><ul class="flex flex-wrap group"><li class="flex-shrink-0"><a class="block px-3 pt-6 pb-2 transition bg-slate-800 text-white" href="/">zulvkr</a></li><li class="flex-shrink-0"><a class="block px-3 pt-6 pb-2 transition hover:bg-black hover:bg-opacity-10" href="/portfolio/">Portfolio</a></li><li class="flex-shrink-0 ml-auto"><a class="block pt-4 w-7" href="https://github.com/zulvkr"><svg width="100%" height="100%" version="1.1" viewBox="0 0 11.493 11.209" xmlns="http://www.w3.org/2000/svg"><g transform="translate(-82.861 -76.986)"><path d="m88.607 76.986c-3.1732 0-5.746 2.5728-5.746 5.7467 0 2.5389 1.6464 4.6926 3.9299 5.4529 0.28751 0.0526 0.39229-0.12488 0.39229-0.27728 0-0.13617-0.0049-0.49777-0.0078-0.9772-1.5984 0.34714-1.9357-0.77046-1.9357-0.77046-0.26141-0.66358-0.63818-0.84032-0.63818-0.84032-0.52176-0.35666 0.03951-0.3496 0.03951-0.3496 0.57679 0.0409 0.88018 0.59231 0.88018 0.59231 0.51259 0.87807 1.3451 0.62442 1.6725 0.47766 0.05221-0.37147 0.20038-0.62477 0.36477-0.76835-1.276-0.14499-2.6176-0.63817-2.6176-2.8402 0-0.62724 0.22401-1.1402 0.59161-1.542-0.05927-0.14535-0.25647-0.72955 0.05609-1.5208 0 0 0.4826-0.15451 1.5804 0.58914 0.45826-0.12735 0.95003-0.1912 1.4386-0.19332 0.48789 2e-3 0.97966 0.066 1.4386 0.19332 1.0971-0.74365 1.5787-0.58914 1.5787-0.58914 0.31362 0.79128 0.11642 1.3755 0.05715 1.5208 0.3683 0.40181 0.5909 0.91475 0.5909 1.542 0 2.2077-1.3437 2.6935-2.624 2.8356 0.20638 0.17744 0.39017 0.52811 0.39017 1.0643 0 0.768-0.0071 1.3878-0.0071 1.5762 0 0.15381 0.10336 0.33267 0.39511 0.27658 2.2818-0.76165 3.9268-2.914 3.9268-5.4522 0-3.1739-2.5732-5.7467-5.7471-5.7467" fill="currentColor" fill-rule="evenodd"/></g></svg></a></li></ul></nav><div class="px-4 py-8 xl:px-6"><p class="pb-4 text-sm">— July 1st, 2021</p><h1 id="title" class="pb-6 text-5xl font-display text-gray-900">Python Version and Dependency Management</h1><p id="description" class="max-w-prose font-serif italic text-gray-600">Learning Python as JavaScript Developer Series Part 1.</p></div></div></header><div class="xl:grid xl:grid-cols-6"><div class="xl:col-start-3 xl:col-span-3"><div class="px-4 pt-5 pb-8 mx-auto xl:ml-6 xl:mr-auto xl:pt-12 max-w-prose xl:px-6"><div><article class="prose"><h2>Background story</h2><p>I was learning Python to build a REST API server using Django with little experience in Python. People praised Django official documentation but I find it difficult to grok for the inexperienced. The reasons are:</p><ol><li>The sheer amount of documentation available causes information overload.</li><li>I feel the way Django is structured, the tons of imports and nested modules makes me question the design choice. Which possibly due to</li><li>Legacy. Legacy and choices available are distracting.</li></ol><p>But even before touching Django or any Python tutorials, there are some pythonic stumble blocks that need to be addressed. It's a common knowledge that I hoped to have learned before starting any Python project.</p><h2>Dependency Management and Python Environment</h2><p>You will find all Python packages use pip in the installation section, but in actual projects no one uses that. Using pip to install means installing a dependency globally on the default Python version in your system.</p><p>It's like using <code>npm -g install some-app</code>, and you aren't sure which version of Python you use.</p><p>Even worse, there are at least 5 solutions to resolve the Python virtual environment (more on this later).</p><h3>Introduction to pyenv</h3><p>Python installation in various operating systems is kind of messy, some use Python 2, some Python 3. Some install them as python2 and python3 instead of python. Python version manager is a necessity.</p><p>You can use <a href="https://github.com/pyenv/pyenv">pyenv</a> to juggle between Python versions. If you are on Linux you may want to use <a href="https://github.com/pyenv/pyenv-installer">pyenv installer</a>.</p><p>Are you familiar with Node Version Management (nvm)? pyenv API has some similarity with nvm. You can call pyenv to see all available commands. I noted common pyenv commands and similar nvm command counterpart.</p><table><thead><tr><th>Command</th><th>Description</th><th>Similar nvm command</th></tr></thead><tbody><tr><td>pyenv version</td><td>Check version used in the directory</td><td>nvm current</td></tr><tr><td>pyenv versions</td><td>List installed versions</td><td>nvm ls</td></tr><tr><td>pyenv install 3</td><td>List available Python 3 to install</td><td>nvm ls-remote 14</td></tr><tr><td>pyenv install 3.10.1</td><td>Install a version</td><td>nvm install 14.18.2</td></tr><tr><td>pyenv global</td><td>Show global version</td><td>nvm alias default</td></tr><tr><td>pyenv global 3.10.1</td><td>Set global version</td><td>nvm alias default 14.18.2</td></tr><tr><td>pyenv local 3.10.1</td><td>Set local version, saved in .python-version</td><td>node -v &gt; .nvmrc</td></tr></tbody></table><p>*: pyenv resolves the python version per directory, while nvm resolves the node version globally. Calling <code>nvm use default</code> will set node to default alias so it's rather similar with global python version.</p><h2>Introduction to Poetry and virtual environment</h2><p>When installing a package using pip, by default your shell will identify the global python environment and install the package globally. We don't want to install packages globally, so we need to set up <a href="https://docs.python.org/3/library/venv.html">virtual environment</a> and activate it.</p><p>After activating the virtual environment in the shell, subsequent Python commands will use the virtual environment as interpreter and packages will be installed locally in the virtual environment. Think of it as “node_modules” folder.</p><p>Previously people used venv, virtualenv, pipenv and all its variations to manage virtual environments. Now <a href="https://python-poetry.org/">Poetry</a> is gaining popularity. Basically its npm for Python plus virtual environment manager.</p><p>Poetry will create:</p><ol><li>Virtual environment</li><li>pyproject.toml, the &quot;package.json&quot;</li><li>poetry.lock, the &quot;package-lock.json&quot;</li></ol><p>Here is a sample of pyproject.toml</p><pre class="language-toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">tool.poetry</span><span class="token punctuation">]</span><br><span class="token key property">name</span> <span class="token punctuation">=</span> <span class="token string">"kulpy"</span><br><span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"0.1.0"</span><br><span class="token key property">description</span> <span class="token punctuation">=</span> <span class="token string">""</span><br><span class="token key property">authors</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"Ivan Zulfikar &lt;ivan.zulf.ikar@gmail.com>"</span><span class="token punctuation">]</span><br><br><span class="token punctuation">[</span><span class="token table class-name">tool.poetry.scripts</span><span class="token punctuation">]</span><br><span class="token key property">dev</span> <span class="token punctuation">=</span> <span class="token string">'fast.scripts:dev'</span><br><br><span class="token punctuation">[</span><span class="token table class-name">tool.poetry.dependencies</span><span class="token punctuation">]</span><br><span class="token key property">python</span> <span class="token punctuation">=</span> <span class="token string">"^3.10"</span><br><span class="token key property">aiohttp</span> <span class="token punctuation">=</span> <span class="token string">"^3.8.1"</span><br><span class="token key property">fastapi</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span><span class="token key property">extras</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"all"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"^0.70.1"</span><span class="token punctuation">}</span><br><br><span class="token punctuation">[</span><span class="token table class-name">tool.poetry.dev-dependencies</span><span class="token punctuation">]</span><br><span class="token key property">pytest</span> <span class="token punctuation">=</span> <span class="token string">"^6.2.5"</span><br><span class="token key property">pytest-cov</span> <span class="token punctuation">=</span> <span class="token string">"^3.0.0"</span><br><span class="token key property">pre-commit</span> <span class="token punctuation">=</span> <span class="token string">"^2.16.0"</span><br><span class="token key property">flake8</span> <span class="token punctuation">=</span> <span class="token string">"^4.0.1"</span><br><span class="token key property">black</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span><span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"^21.12b0"</span><span class="token punctuation">,</span> <span class="token key property">allow-prereleases</span> <span class="token punctuation">=</span> <span class="token boolean">true</span><span class="token punctuation">}</span><br><span class="token key property">mypy</span> <span class="token punctuation">=</span> <span class="token string">"^0.910"</span><br><br><span class="token punctuation">[</span><span class="token table class-name">build-system</span><span class="token punctuation">]</span><br><span class="token key property">requires</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"poetry-core>=1.0.0"</span><span class="token punctuation">]</span><br><span class="token key property">build-backend</span> <span class="token punctuation">=</span> <span class="token string">"poetry.core.masonry.api"</span></code></pre><p>Common commands to use in Poetry and the its npm command counterpart</p><table><thead><tr><th>Command</th><th>Description</th><th>Similar npm command</th></tr></thead><tbody><tr><td>poetry add fastapi['all']</td><td>Install a dependency</td><td>npm install fastify</td></tr><tr><td>poetry add mypy --dev</td><td>Install a dev-dependency</td><td>npm install eslint --dev</td></tr><tr><td>poetry install</td><td>Install dependencies in pyproject.toml</td><td>npm install</td></tr><tr><td>poetry update</td><td>Update deps but not beyond version in pyproject.toml</td><td>npm install</td></tr><tr><td>poetry remove fastapi</td><td>Remove a dependency</td><td>npm uninstall fastify</td></tr><tr><td>poetry remove black --dev</td><td>Remove dev-dependencies in pyproject.toml</td><td>npm uninstall prettier</td></tr><tr><td>poetry shell</td><td>Activate virtual environment</td><td>-</td></tr></tbody></table><h3>Visual Studio Code Integration</h3><p>Visual Studio Code plays really well with Python virtual environment. When using Visual Studio Code, you can run command &quot;Python: Select interpreter&quot; to select the correct Python environment (Command can be accessed with Ctrl + Shift + P). This will tell Visual Studio Code to resolve Python dependency for Intellisense properly.</p><p>Selecting the interpreter also makes Visual Studio Code to auto activate virtual env when opening the integrated terminal.</p><p>Visual Studio Code also can install formatter and linter for you. It will prompt you to install linter and formatter when you use Visual Studio Code command: &quot;Python: run linting&quot; and &quot;Format document&quot;. Clicking the prompt button will install it via the detected package manager, in example when installing black formatter, Visual Studio Code will call <code>poetry add --dev black --allow-prereleases</code> to install it.</p><h2>Alternative to virtual environment: Docker container</h2><p>By using Docker to contain Python, there is no need for a virtual environment to contain the dependencies. But Poetry can work well with Docker by using multistage build.</p><p>If you prefer to use a simple Docker setup, using docker + pip without a virtual environment will be a better choice.</p></article></div></div></div></div></body></html>